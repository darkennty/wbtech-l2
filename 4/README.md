# L2.4

## Задача

Что выведет программа?

Объяснить вывод программы.

```
func main() {
    ch := make(chan int)
    go func() {
        for i := 0; i < 10; i++ {
            ch <- i
        }
    }()
    for n := range ch {
        println(n)
    }
}
```

## Решение

В данном коде происходит работа с небуферизированным каналом. Создаётся горутина, которая черех цикл записывает 10 значений в канал. После описания горутины идёт цикл, считывающий и выводящий в консоль все значения из канала ch.

Цикл считывания значений из канала ch будет производиться до тех пор, пока канал не будет закрыт. И так как в данном коде нет команды close(ch) для закрытия канала, цикл будет работать бесконечно. После того, как из канала будут считаны все десять отправленных в него значений, возникнет неразрешимая ситуация - цикл будет пытаться считать из канала значение, но в этот канал значения больше отправляться не будут. Возникает deadlock.

Чтобы решить данную проблему, нужно добавить команду `close(ch)` в код в конце описания горутины. Благодаря этому после записи всех нужных значений в канал он закроется, и, соответственно, после завершения считывания всех значений из канала цикл успешно завершится, а программа закончит работу.

## Пример запуска программы

```
$ go run 4/main.go
0
1
2
3
4
5
6
7
8
9
fatal error: all goroutines are asleep - deadlock!
```